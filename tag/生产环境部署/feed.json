{
    "version": "https://jsonfeed.org/version/1",
    "title": "The course of true love never did run smooth. • All posts by \"生产环境部署\" tag",
    "description": "不知道写啥",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/Django%E6%A1%86%E6%9E%B6/Django-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/",
            "url": "http://example.com/Django%E6%A1%86%E6%9E%B6/Django-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/",
            "title": "Django + Uwsgi + Nginx 的生产环境部署",
            "date_published": "2020-12-04T14:01:03.000Z",
            "content_html": "<h2 id=\"django\"><a class=\"markdownIt-Anchor\" href=\"#django\">#</a> Django</h2>\n<blockquote>\n<p><code>Django</code>  是一个 <code>Web框架</code> ，框架的作用在于处理 <code>request</code>  和 <code>reponse</code> ，其他的不是框架所关心的内容。</p>\n<p>所以如何部署 <code>Django</code>  不是 <code>Django</code>  所需要关心的。</p>\n</blockquote>\n<h2 id=\"什么是wsgi\"><a class=\"markdownIt-Anchor\" href=\"#什么是wsgi\">#</a> 什么是 WSGI</h2>\n<blockquote>\n<p><code>WSGI</code>  是一种  <code>python</code>  专用 的 <code>web</code>  协议 和 <code>http</code>  类似</p>\n<p>WSGI 实质： <code>WSGI</code>  是一种描述 web 服务器（如  <code>nginx</code> ， <code>uWSGI web服务器</code>  ）如何与 <code>web框架</code>  （如用  <code>Django</code> 、 <code>Flask框架</code> 写的程序）通信的规范、协议</p>\n<p><code>WSGI</code>  定义了使用  <code>python</code>  编写的 <code>web app(django)</code>  与 <code>web server（uWSGI）</code> 之间接口格式</p>\n</blockquote>\n<h2 id=\"为什么需要web协议\"><a class=\"markdownIt-Anchor\" href=\"#为什么需要web协议\">#</a> 为什么需要 web 协议</h2>\n<blockquote>\n<p>不同的框架有不同的开发方式，但是无论如何，开发出的 应用程序 ( <code>django</code> ) 都要和服务器 ( <code>nginx</code> ) 程序配合 ，才能为用户提供服务</p>\n<p>这样， 服务器程序 ( <code>nginx</code> ) 就需要为不同的框架提供不同的支持，只有支持它的服务器才 能被开发出的应用使用，显然这是不可行的。</p>\n<p><code>web协议本质</code> ：就是定义了 <code> Web服务器</code> 和 <code>Web应用程序</code> 或 <code>框架</code> 之间的一种简单而通用的接口规范</p>\n</blockquote>\n<h2 id=\"什么是uwsgi\"><a class=\"markdownIt-Anchor\" href=\"#什么是uwsgi\">#</a> 什么是 uWSGI</h2>\n<blockquote>\n<p><code>uWSGI</code>  是一个全功能的 HTTP 服务器，实现了 <code>WSGI协议</code> 、 <code>uwsgi协议</code> 、 <code>http协议</code> 等。</p>\n</blockquote>\n<h2 id=\"uwsgi作用\"><a class=\"markdownIt-Anchor\" href=\"#uwsgi作用\">#</a> uWSGI 作用</h2>\n<blockquote>\n<p>它要做的就是把 <code>HTTP协议</code> 转化成语言支持的网络协议，比如把 <code>HTTP协议</code> 转化成 <code>WSGI协议</code> ，让 <code>Python</code>  可以直接使用。</p>\n</blockquote>\n<h2 id=\"uwsgi特点\"><a class=\"markdownIt-Anchor\" href=\"#uwsgi特点\">#</a> uWSGI 特点</h2>\n<blockquote>\n<p>轻量级，易部署，性能比 <code>nginx</code>  差很多</p>\n</blockquote>\n<p><code>注意</code> ：</p>\n<ul>\n<li>如果架构是 <code>Nginx</code> + <code>uWSGI</code> + <code>APP</code> ， <code>uWSGI</code>  是一个中间件</li>\n<li>如果架构是 <code>uWSGI</code> + <code>APP</code> ， <code>uWSGI</code>  是一个服务器</li>\n</ul>\n<h2 id=\"nginx\"><a class=\"markdownIt-Anchor\" href=\"#nginx\">#</a> Nginx</h2>\n<blockquote>\n<p><code>Nginx</code>  是一个 Web 服务器，其中的 HTTP 服务器功能和 <code>uWSGI</code>  功能很类似</p>\n<p>但是 <code>Nginx</code>  还可以用作更多用途，比如最常用的反向代理、负载均衡、拦截攻击等，而且性能极高</p>\n</blockquote>\n<h2 id=\"django-uwsgi-nginx-部署的作用\"><a class=\"markdownIt-Anchor\" href=\"#django-uwsgi-nginx-部署的作用\">#</a> Django + Uwsgi + Nginx 部署的作用</h2>\n<h3 id=\"django-uwsgi-nginx方案\"><a class=\"markdownIt-Anchor\" href=\"#django-uwsgi-nginx方案\">#</a> Django + Uwsgi + Nginx 方案</h3>\n<p><img data-src=\"1.png\" alt=\"\"></p>\n<h4 id=\"请求处理整体流程\"><a class=\"markdownIt-Anchor\" href=\"#请求处理整体流程\">#</a> 请求处理整体流程</h4>\n<ul>\n<li><code>nginx</code>  接收到浏览器发送过来的 <code>http请求</code> ，将包进行解析，分析 url</li>\n<li>静态文件请求：就直接访问用户给 <code>nginx</code>  配置的静态文件目录，直接返回用户请求的静态文件  <code>(html/css/js/图片) </code></li>\n<li>动态接口请求：那么 <code>nginx</code>  就将请求转发给 <code>uWSGI</code> ，最后到达 <code>django</code>  处理</li>\n</ul>\n<h4 id=\"各模块作用\"><a class=\"markdownIt-Anchor\" href=\"#各模块作用\">#</a> 各模块作用</h4>\n<ul>\n<li>\n<p><code>nginx</code> ：是对外的服务器，外部浏览器通过 <code>url</code>  访问 <code>nginx</code> ， <code>nginx</code>  主要处理静态请求</p>\n</li>\n<li>\n<p><code>uWSGI</code> ：是对内的服务器，主要用来处理动态请求</p>\n</li>\n<li>\n<p><code>uwsgi</code> ：是一种 <code>web协议</code> ，接收到请求之后将包进行处理，处理成 <code>wsgi</code>  可以接受的格式，并发给 <code>wsgi</code></p>\n</li>\n<li>\n<p><code>wsgi</code> ：是 <code>python</code>  专用的 <code>web协议</code> ，根据请求调用应用程序 <code>（Django）</code> 的某个文件，某个文件的某个函数</p>\n</li>\n<li>\n<p><code>Django</code> ：是真正干活的，查询数据等资源，把处理的结果再次返回给 <code>WSGI</code> ，  <code>WSGI</code>  将返回值进行打包，打包成 <code>uwsgi</code>  能够接收的格式</p>\n</li>\n<li>\n<p><code>uwsgi</code>  接收 <code>wsgi</code>  发送的请求，并转发给 <code>nginx</code> , <code>nginx</code>  最终将返回值返回给浏览器</p>\n</li>\n</ul>\n<h3 id=\"django-uwsgi方案\"><a class=\"markdownIt-Anchor\" href=\"#django-uwsgi方案\">#</a> Django + uwsgi 方案</h3>\n<ul>\n<li>\n<p>没有 <code>nginx</code>  而只有 <code>uwsgi</code>  的服务器，则是 <code>Internet请求</code> 直接由 <code>uwsgi</code>  处理，并反馈到 <code>web项目</code> 中。</p>\n</li>\n<li>\n<p><code>nginx</code>  可以实现安全过滤，防 <code>DDOS</code>  等保护安全的操作，并且如果配置了多台服务器， <code>nginx</code>  可以保证服务器的负载相对均衡。</p>\n</li>\n<li>\n<p>而 <code>uwsgi</code>  则是一个 <code>web服务器</code> ，实现了 <code>WSGI协议(Web Server Gateway Interface)</code> ， <code>http协议</code> 等，它可以接收和处理请求，发出响应等。<br>\n只用 <code>uwsgi</code>  也是可以的。</p>\n</li>\n</ul>\n<h3 id=\"nginx和uwsgi特点\"><a class=\"markdownIt-Anchor\" href=\"#nginx和uwsgi特点\">#</a> nginx 和 uWSGI 特点</h3>\n<h4 id=\"nginx的作用\"><a class=\"markdownIt-Anchor\" href=\"#nginx的作用\">#</a> nginx 的作用</h4>\n<ul>\n<li>\n<p>反向代理，可以拦截一些 <code>web攻击</code> ，保护后端的 <code>web服务器</code></p>\n</li>\n<li>\n<p>负载均衡，根据轮询算法，分配请求到多节点 <code>web服务器</code></p>\n</li>\n<li>\n<p>缓存静态资源，加快访问速度，释放 <code>web服务器</code> 的内存占用，专项专用</p>\n</li>\n</ul>\n<h4 id=\"uwsgi的适用\"><a class=\"markdownIt-Anchor\" href=\"#uwsgi的适用\">#</a> uWSGI 的适用</h4>\n<ul>\n<li>\n<p>单节点服务器的简易部署</p>\n</li>\n<li>\n<p>轻量级，好部署</p>\n</li>\n</ul>\n<h2 id=\"django-uwsgi-nginx-的生产环境部署\"><a class=\"markdownIt-Anchor\" href=\"#django-uwsgi-nginx-的生产环境部署\">#</a> Django + Uwsgi + Nginx 的生产环境部署</h2>\n<h3 id=\"django的settingspy配置\"><a class=\"markdownIt-Anchor\" href=\"#django的settingspy配置\">#</a> Django 的 <code>settings.py</code>  配置</h3>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 1. 修改配置 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 正式上线关闭调试模式，不会暴露服务器信息 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>DEBUG <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 2. 允许的主机 </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ALLOWED_HOSTS <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'xxx.com'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 3. 前端修改接口地址（vue）</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>http<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span><span class=\"token number\">192.168</span><span class=\"token number\">.56</span><span class=\"token number\">.100</span><span class=\"token punctuation\">:</span><span class=\"token number\">8888</span><span class=\"token operator\">/</span>   <span class=\"token operator\">=</span><span class=\"token operator\">></span>  http<span class=\"token punctuation\">:</span><span class=\"token operator\">//</span>xxx<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 4.MySQL 数据库根据实际情况配置（注意地址）</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>DATABASES <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token string\">'default'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">'ENGINE'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'django.db.backends.mysql'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token string\">'NAME'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'loonflow'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token string\">'USER'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'root'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token string\">'PASSWORD'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token string\">'HOST'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'127.0.0.1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token string\">'PORT'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3306'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 5. 缓存配置，改为默认，最简单形式（配置 redis）</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>CACHES <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token string\">\"BACKEND\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"django_redis.cache.RedisCache\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token string\">\"LOCATION\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"redis://127.0.0.1:6379/0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token string\">\"CLIENT_CLASS\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"django_redis.client.DefaultClient\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\"># 6. 收集静态文件 </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\"># 静态资源收集位置 </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>STATIC_ROOT <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>BASE_DIR<span class=\"token punctuation\">,</span> <span class=\"token string\">'static'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\"># 7. 命令行执行 </span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>python manage<span class=\"token punctuation\">.</span>py collectstatic</pre></td></tr></table></figure><h3 id=\"安装uwsgi-配置uwsgi\"><a class=\"markdownIt-Anchor\" href=\"#安装uwsgi-配置uwsgi\">#</a> 安装 uwsgi 配置 uWSGI</h3>\n<h4 id=\"安装uwsgi\"><a class=\"markdownIt-Anchor\" href=\"#安装uwsgi\">#</a> 安装 uwsgi</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>workon syl\t\t\t\t\t<span class=\"token comment\"># 进入虚拟环境 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>pip3 install uwsgi\t\t\t\t<span class=\"token comment\"># 安装</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>whereis uwsgi          \t\t\t<span class=\"token comment\"># 查看 uwsgi 安装路径 uwsgi: </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">/</span>root<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>virtualenvs<span class=\"token operator\">/</span>syl<span class=\"token operator\">/</span><span class=\"token builtin\">bin</span><span class=\"token operator\">/</span>uwsgi</pre></td></tr></table></figure><h4 id=\"配置uwgsiini启动文件\"><a class=\"markdownIt-Anchor\" href=\"#配置uwgsiini启动文件\">#</a> 配置 uwgsi.ini 启动文件</h4>\n<ul>\n<li>在 <code> uwsgi_conf</code>  下新建 <code>uwsgi.ini</code></li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>uwsgi<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 使用 Nginx 连接时使用，Django 程序所在服务器地址和端口号</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>socket<span class=\"token operator\">=</span><span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">8000</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 项目目录绝对路径</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>chdir<span class=\"token operator\">=</span><span class=\"token operator\">/</span>root<span class=\"token operator\">/</span>loonflow_project<span class=\"token operator\">/</span>loonflow</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 项目中 wsgi.py 文件的目录，相对于项目目录</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>wsgi<span class=\"token operator\">-</span><span class=\"token builtin\">file</span><span class=\"token operator\">=</span>loonflow<span class=\"token operator\">/</span>wsgi<span class=\"token punctuation\">.</span>py</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 进程数（机器核数的 1 倍）</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>processes<span class=\"token operator\">=</span><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 线程数</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>threads<span class=\"token operator\">=</span><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># uwsgi 服务器的角色</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>master<span class=\"token operator\">=</span><span class=\"token boolean\">True</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 存放进程编号的文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>pidfile<span class=\"token operator\">=</span>uwsgi<span class=\"token punctuation\">.</span>pid</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 日志文件</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>daemonize<span class=\"token operator\">=</span>uwsgi<span class=\"token punctuation\">.</span>log</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 指定依赖的虚拟环境</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>virtualenv<span class=\"token operator\">=</span><span class=\"token operator\">/</span>root<span class=\"token operator\">/</span><span class=\"token punctuation\">.</span>virtualenvs<span class=\"token operator\">/</span>syl</pre></td></tr></table></figure><h3 id=\"安装与配置nginx\"><a class=\"markdownIt-Anchor\" href=\"#安装与配置nginx\">#</a> 安装与配置 nginx</h3>\n<h4 id=\"安装nginx\"><a class=\"markdownIt-Anchor\" href=\"#安装nginx\">#</a> 安装 nginx</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>workon syl\t\t\t\t\t<span class=\"token comment\"># 进入虚拟环境 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>sudo apt update\t\t\t\t<span class=\"token comment\"># 更新 apt </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>sudo apt install nginx           \t\t<span class=\"token comment\"># 安装 nginx</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>sudo systemctl status nginx      \t\t<span class=\"token comment\"># 查看 nginx 状态</span></pre></td></tr></table></figure><h4 id=\"配置nginx\"><a class=\"markdownIt-Anchor\" href=\"#配置nginx\">#</a> 配置 nginx</h4>\n<ul>\n<li>在 <code>/etc/nginx/conf.d/</code>  文件夹下新建任意名字  <code>xxx.conf</code>  即可，写入的内容是官方给的</li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    listen          <span class=\"token number\">8888</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    server_name     <span class=\"token number\">192.168</span><span class=\"token number\">.56</span><span class=\"token number\">.100</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    location <span class=\"token operator\">/</span>static <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        alias <span class=\"token operator\">/</span>root<span class=\"token operator\">/</span>loonflow_project<span class=\"token operator\">/</span>loonflow<span class=\"token operator\">/</span>static<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    location <span class=\"token operator\">/</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        include uwsgi_params<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        uwsgi_pass <span class=\"token number\">127.0</span><span class=\"token number\">.0</span><span class=\"token number\">.1</span><span class=\"token punctuation\">:</span><span class=\"token number\">8000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        uwsgi_ignore_client_abort on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"etcnginxnginxconfnginx主配置文件解读-不用变\"><a class=\"markdownIt-Anchor\" href=\"#etcnginxnginxconfnginx主配置文件解读-不用变\">#</a>  <code>/etc/nginx/nginx.conf</code> nginx 主配置文件解读 (不用变)</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>user www<span class=\"token operator\">-</span>data<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>worker_processes auto<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pid <span class=\"token operator\">/</span>run<span class=\"token operator\">/</span>nginx<span class=\"token punctuation\">.</span>pid<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>include <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>modules<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>events <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tworker_connections <span class=\"token number\">768</span><span class=\"token punctuation\">;</span>\t\t\t <span class=\"token comment\"># 链接数量 </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>http <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tsendfile on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\ttcp_nopush on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\ttcp_nodelay on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tkeepalive_timeout <span class=\"token number\">65</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\ttypes_hash_max_size <span class=\"token number\">2048</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tinclude <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>mime<span class=\"token punctuation\">.</span>types<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tdefault_type application<span class=\"token operator\">/</span>octet<span class=\"token operator\">-</span>stream<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tssl_protocols TLSv1 TLSv1<span class=\"token punctuation\">.</span><span class=\"token number\">1</span> TLSv1<span class=\"token punctuation\">.</span><span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token comment\"># Dropping SSLv3, ref: POODLE</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tssl_prefer_server_ciphers on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\taccess_log <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>access<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">;</span>\t\t <span class=\"token comment\"># 客户浏览器访问 nginx 服务记录（客 户户端访问异常时可以查看）</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\terror_log <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>error<span class=\"token punctuation\">.</span>log<span class=\"token punctuation\">;</span>\t\t\t <span class=\"token comment\"># nginx 错误日志（nginx 启动时报错 的日志）</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tgzip on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tinclude <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>conf<span class=\"token punctuation\">.</span>d<span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">;</span>\t\t\t <span class=\"token comment\"># nginx 扩展配置文件 </span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tinclude <span class=\"token operator\">/</span>etc<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>sites<span class=\"token operator\">-</span>enabled<span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"nginx和uwsgi启动-关闭-查看日志命令\"><a class=\"markdownIt-Anchor\" href=\"#nginx和uwsgi启动-关闭-查看日志命令\">#</a> nginx 和 uwsgi 启动、关闭、查看日志命令</h2>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token triple-quoted-string string\">'''1.启动并查看nginx日志'''</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>systemctl restart nginx         \t <span class=\"token comment\"># 开启 nginx </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>tail <span class=\"token operator\">-</span>f <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>access<span class=\"token punctuation\">.</span>log    <span class=\"token comment\"># 查看 nginx 接入日志 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>tail <span class=\"token operator\">-</span>f <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>error<span class=\"token punctuation\">.</span>log     <span class=\"token comment\"># 查看 nginx 错误日志</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token triple-quoted-string string\">'''2.启动并查看uwsgi日志'''</span>     </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>cd <span class=\"token operator\">/</span>teach<span class=\"token operator\">/</span>shiyanlou_project<span class=\"token operator\">/</span>uwsgi_conf   <span class=\"token comment\"># 进入项目目录 </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>uwsgi <span class=\"token operator\">-</span><span class=\"token operator\">-</span>ini uwsgi<span class=\"token punctuation\">.</span>ini                    <span class=\"token comment\"># 启动 uwsgi 的 django 项目    </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>uwsgi <span class=\"token operator\">-</span><span class=\"token operator\">-</span>stop uwsgi<span class=\"token punctuation\">.</span>pid\t\t\t<span class=\"token comment\"># 关闭 uwsgi     </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>tail <span class=\"token operator\">-</span>f uwsgi<span class=\"token punctuation\">.</span>log                        <span class=\"token comment\"># 查看 uwsgi 日志    </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>tail <span class=\"token operator\">-</span>f <span class=\"token operator\">*</span>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>ps <span class=\"token operator\">-</span>ef<span class=\"token operator\">|</span>grep uwsgi       \t\t\t\t<span class=\"token comment\"># 查看 uwsgi 服务是否启动</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    root      <span class=\"token number\">92328</span>  <span class=\"token number\">89266</span>  <span class=\"token number\">0</span> <span class=\"token number\">14</span><span class=\"token punctuation\">:</span><span class=\"token number\">37</span> pts<span class=\"token operator\">/</span><span class=\"token number\">1</span>    <span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span><span class=\"token punctuation\">:</span><span class=\"token number\">00</span> grep <span class=\"token operator\">-</span><span class=\"token operator\">-</span>color<span class=\"token operator\">=</span>auto uwsgi</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">:</span>uwsgi_conf<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>netstat <span class=\"token operator\">-</span>anptu <span class=\"token operator\">|</span> grep <span class=\"token number\">8888</span>\t\t\t<span class=\"token comment\"># 查看 8888 端口被哪一个程序 占用</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>tail <span class=\"token operator\">-</span>f access_log <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>access<span class=\"token punctuation\">.</span>log\t\t<span class=\"token comment\"># 接入日志 </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>root@dev<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>tail <span class=\"token operator\">-</span>f <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>error<span class=\"token punctuation\">.</span>log\t\t\t\t<span class=\"token comment\"># 当你启动、关闭 nginx 时报错</span></pre></td></tr></table></figure>",
            "tags": [
                "生产环境部署"
            ]
        }
    ]
}