{
    "version": "https://jsonfeed.org/version/1",
    "title": "The course of true love never did run smooth. • All posts by \"wechat\" tag",
    "description": "不知道写啥",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/Django%E6%A1%86%E6%9E%B6/wechat-%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98/",
            "url": "http://example.com/Django%E6%A1%86%E6%9E%B6/wechat-%E6%89%AB%E7%A0%81%E6%94%AF%E4%BB%98/",
            "title": "Wechat--扫码支付",
            "date_published": "2020-12-27T08:35:04.000Z",
            "content_html": "<h1 id=\"概述\"><a class=\"markdownIt-Anchor\" href=\"#概述\">#</a> 概述</h1>\n<blockquote>\n<p>在生活中真正具有广泛性、高效性、使用方便性的支付方式还得是扫码支付，扫码的优点在于推广成本低，上至钓鱼台国宾馆，下至发廊地摊都能用，打印出来就完事了，而相比其他支付方式，现金的找零及假钞问题，信用卡的办理门槛、pos 机的沉没成本，所以基于二维码的扫码支付的确是非常符合国情的。</p>\n</blockquote>\n<h1 id=\"python3-django22-vue-实现微信扫码支付\"><a class=\"markdownIt-Anchor\" href=\"#python3-django22-vue-实现微信扫码支付\">#</a> Python3 + Django2.2 + Vue 实现微信扫码支付</h1>\n<h2 id=\"wechat\"><a class=\"markdownIt-Anchor\" href=\"#wechat\">#</a> Wechat</h2>\n<ol>\n<li>首先注册微信公众平台</li>\n</ol>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29t\">https://mp.weixin.qq.com</span></p>\n</blockquote>\n<ul>\n<li>获得开发者 id 和秘钥 (appid &amp; appsecret)</li>\n</ul>\n<p><img data-src=\"1.png\" alt=\"\"></p>\n<ul>\n<li>同时确保获取微信支付接口的权限</li>\n</ul>\n<p><img data-src=\"2.png\" alt=\"\"></p>\n<ol start=\"2\">\n<li>随后注册微信支付商户平台</li>\n</ol>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXkud2VpeGluLnFxLmNvbS8=\">https://pay.weixin.qq.com/</span></p>\n</blockquote>\n<ul>\n<li>获取微信支付的商户号 (在账户信息页面)</li>\n</ul>\n<p><img data-src=\"3.png\" alt=\"\"></p>\n<ul>\n<li>获取微信支付接口的秘钥 (账户中心 -&gt;api 安全)</li>\n</ul>\n<p><img data-src=\"4.png\" alt=\"\"></p>\n<ul>\n<li>产品中心 -&gt; 开发配置页面，配置支付域名</li>\n</ul>\n<p><img data-src=\"5.png\" alt=\"\"></p>\n<div class=\"note info\">\n<p>扫码支付域名既支持 https 也支持 http，非常方便，同时注意域名必须是一个备案域名。</p>\n</div>\n<h2 id=\"django\"><a class=\"markdownIt-Anchor\" href=\"#django\">#</a> Django</h2>\n<ol>\n<li>首先导入依赖的库和一些工具方法</li>\n</ol>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>http <span class=\"token keyword\">import</span> HttpResponse<span class=\"token punctuation\">,</span> HttpResponseRedirect</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> random</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> hashlib</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> qrcode</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">from</span> bs4 <span class=\"token keyword\">import</span> BeautifulSoup</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">trans_xml_to_dict</span><span class=\"token punctuation\">(</span>data_xml<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    soup <span class=\"token operator\">=</span> BeautifulSoup<span class=\"token punctuation\">(</span>data_xml<span class=\"token punctuation\">,</span> features<span class=\"token operator\">=</span><span class=\"token string\">'xml'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    xml <span class=\"token operator\">=</span> soup<span class=\"token punctuation\">.</span>find<span class=\"token punctuation\">(</span><span class=\"token string\">'xml'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 解析 XML</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> xml<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    data_dict <span class=\"token operator\">=</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> item<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> item <span class=\"token keyword\">in</span> xml<span class=\"token punctuation\">.</span>find_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span> data_dict</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">trans_dict_to_xml</span><span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 定义字典转 XML 的函数</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    data_xml <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 遍历字典排序后的 key</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        v <span class=\"token operator\">=</span> data_dict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 取出字典中 key 对应的 value</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">if</span> k <span class=\"token operator\">==</span> <span class=\"token string\">'detail'</span> <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> v<span class=\"token punctuation\">.</span>startswith<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;![CDATA['</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 添加 XML 标记</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            v <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;![CDATA[&#123;&#125;]]>'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        data_xml<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;&#123;key&#125;>&#123;value&#125;&lt;/&#123;key&#125;>'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span>k<span class=\"token punctuation\">,</span> value<span class=\"token operator\">=</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">'&lt;xml>&#123;&#125;&lt;/xml>'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>data_xml<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 返回 XML</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">get_sign</span><span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 签名函数，参数为签名的数据和密钥</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    params_list <span class=\"token operator\">=</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token keyword\">lambda</span> e<span class=\"token punctuation\">:</span> e<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 参数字典倒排序为列表</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    params_str <span class=\"token operator\">=</span> <span class=\"token string\">\"&amp;\"</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token string\">u\"&#123;&#125;=&#123;&#125;\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> params_list<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'&amp;key='</span> <span class=\"token operator\">+</span> key</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token comment\"># 组织参数字符串并在末尾添加商户交易密钥</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    md5 <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>md5<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 使用 MD5 加密模式</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    md5<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>params_str<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 将参数字符串传入</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    sign <span class=\"token operator\">=</span> md5<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>upper<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 完成加密并转为大写</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">return</span> sign</pre></td></tr></table></figure><ol start=\"2\">\n<li>编写支付逻辑，参考微信官方文档</li>\n</ol>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXkud2VpeGluLnFxLmNvbS93aWtpL2RvYy9hcGkvbmF0aXZlLnBocD9jaGFwdGVyPTZfNSZhbXA7aW5kZXg9Mw==\">https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_5&amp;index=3</span></p>\n</blockquote>\n<details class=\"primary\"><summary>业务流程说明</summary><div>\n<p>（1）商户后台系统根据用户选购的商品生成订单。</p>\n<p>（2）用户确认支付后调用微信支付【统一下单 API】生成预支付交易；</p>\n<p>（3）微信支付系统收到请求后生成预支付交易单，并返回交易会话的二维码链接 code_url。</p>\n<p>（4）商户后台系统根据返回的 code_url 生成二维码。</p>\n<p>（5）用户打开微信 “扫一扫” 扫描二维码，微信客户端将扫码内容发送到微信支付系统。</p>\n<p>（6）微信支付系统收到客户端请求，验证链接有效性后发起用户支付，要求用户授权。</p>\n<p>（7）用户在微信客户端输入密码，确认支付后，微信客户端提交授权。</p>\n<p>（8）微信支付系统根据用户授权完成支付交易。</p>\n<p>（9）微信支付系统完成支付交易后给微信客户端返回交易结果，并将交易结果通过短信、微信消息提示用户。微信客户端展示支付交易结果页面。</p>\n<p>（10）微信支付系统通过发送异步消息通知商户后台系统支付结果。商户后台系统需回复接收情况，通知微信后台系统不再发送该单的支付通知。</p>\n<p>（11）未收到支付通知的情况，商户后台系统调用【查询订单 API】。</p>\n<p>（12）商户确认订单已支付后给用户发货。</p>\n</div></details>\n<ul>\n<li>我们需要调用微信的统一下单接口文档</li>\n</ul>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXkud2VpeGluLnFxLmNvbS93aWtpL2RvYy9hcGkvbmF0aXZlLnBocD9jaGFwdGVyPTlfMQ==\">https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_1</span></p>\n</blockquote>\n<ul>\n<li>编写逻辑</li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">wx_pay</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    url <span class=\"token operator\">=</span> <span class=\"token string\">'https://api.mch.weixin.qq.com/pay/unifiedorder'</span>  <span class=\"token comment\"># 微信扫码支付接口</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    key <span class=\"token operator\">=</span> <span class=\"token string\">'945bec********a8fbf7d7'</span>  <span class=\"token comment\">#商户 api 秘钥</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    total_fee <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token comment\">#支付金额，单位分</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    body <span class=\"token operator\">=</span> <span class=\"token string\">'123123'</span>  <span class=\"token comment\"># 商品描述</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    out_trade_no <span class=\"token operator\">=</span> <span class=\"token string\">'order_%s'</span> <span class=\"token operator\">%</span> random<span class=\"token punctuation\">.</span>randrange<span class=\"token punctuation\">(</span><span class=\"token number\">100000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">999999</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 订单编号</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    params <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token string\">'appid'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'wx09*****f'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># APPID</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token string\">'mch_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'16****08'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 商户号</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">'notify_url'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'http://wxpay.v3u.cn/wx_back/'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 支付域名回调地址</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">'product_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'goods_%s'</span> <span class=\"token operator\">%</span> random<span class=\"token punctuation\">.</span>randrange<span class=\"token punctuation\">(</span><span class=\"token number\">100000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">999999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 商品编号</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">'trade_type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'NATIVE'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 支付类型（扫码支付）</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">'spbill_create_ip'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'114.254.176.137'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 发送请求服务器的 IP 地址</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token string\">'total_fee'</span><span class=\"token punctuation\">:</span> total_fee<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 订单总金额</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token string\">'out_trade_no'</span><span class=\"token punctuation\">:</span> out_trade_no<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 订单编号</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token string\">'body'</span><span class=\"token punctuation\">:</span> body<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 商品描述</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token string\">'nonce_str'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ibuaiVcKdpRxkhJA'</span>  <span class=\"token comment\"># 字符串</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    sign <span class=\"token operator\">=</span> get_sign<span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 获取签名</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    params<span class=\"token punctuation\">.</span>setdefault<span class=\"token punctuation\">(</span><span class=\"token string\">'sign'</span><span class=\"token punctuation\">,</span> sign<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 添加签名到参数字典</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    xml <span class=\"token operator\">=</span> trans_dict_to_xml<span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 转换字典为 XML</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>xml<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 以 POST 方式向微信公众平台服务器发起请求</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    data_dict <span class=\"token operator\">=</span> trans_xml_to_dict<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 将请求返回的数据转为字典</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    qrcode_name <span class=\"token operator\">=</span> out_trade_no <span class=\"token operator\">+</span> <span class=\"token string\">'.png'</span>  <span class=\"token comment\"># 支付二维码图片保存路径</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">if</span> data_dict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'return_code'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">'SUCCESS'</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 如果请求成功</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        img <span class=\"token operator\">=</span> qrcode<span class=\"token punctuation\">.</span>make<span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'code_url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 创建支付二维码片</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        img<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span><span class=\"token string\">'./'</span> <span class=\"token operator\">+</span> qrcode_name<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 保存支付二维码</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span>qrcode_name<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>访问 http://localhost:8000/wx_pay/</li>\n</ol>\n<p><img data-src=\"6.png\" alt=\"\"></p>\n<h2 id=\"vue\"><a class=\"markdownIt-Anchor\" href=\"#vue\">#</a> Vue</h2>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>center</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>扫码支付<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>center</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a-form-item</span> <span class=\"token attr-name\">v-bind</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>formItemLayout<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>金额<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a-input</span> <span class=\"token attr-name\">v-model</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>money<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a-form-item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a-form-item</span> <span class=\"token attr-name\">v-bind</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tailFormItemLayout<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a-button</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>primary<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">html-type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        生成二维码</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a-button</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a-form-item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a-form-item</span> <span class=\"token attr-name\">v-bind</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>formItemLayout<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">label</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>二维码<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">:src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>src<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a-form-item</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      money<span class=\"token operator\">:</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      src<span class=\"token operator\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      formItemLayout<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        labelCol<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>          xs<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> span<span class=\"token operator\">:</span> <span class=\"token number\">24</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          sm<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> span<span class=\"token operator\">:</span> <span class=\"token number\">8</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        wrapperCol<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>          xs<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> span<span class=\"token operator\">:</span> <span class=\"token number\">24</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>          sm<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> span<span class=\"token operator\">:</span> <span class=\"token number\">16</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      tailFormItemLayout<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        wrapperCol<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          xs<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            span<span class=\"token operator\">:</span> <span class=\"token number\">24</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>            offset<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>          sm<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            span<span class=\"token operator\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            offset<span class=\"token operator\">:</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      dataSource<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>          key<span class=\"token operator\">:</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          name<span class=\"token operator\">:</span> <span class=\"token string\">'Edward King 0'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>          age<span class=\"token operator\">:</span> <span class=\"token string\">'32'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>          address<span class=\"token operator\">:</span> <span class=\"token string\">'London, Park Lane no. 0'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>          key<span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>          name<span class=\"token operator\">:</span> <span class=\"token string\">'Edward King 1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>          age<span class=\"token operator\">:</span> <span class=\"token string\">'32'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>          address<span class=\"token operator\">:</span> <span class=\"token string\">'London, Park Lane no. 1'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      columns<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>          title<span class=\"token operator\">:</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>          dataIndex<span class=\"token operator\">:</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>          title<span class=\"token operator\">:</span> <span class=\"token string\">'age'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>          dataIndex<span class=\"token operator\">:</span> <span class=\"token string\">'age'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>          title<span class=\"token operator\">:</span> <span class=\"token string\">'address'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>          dataIndex<span class=\"token operator\">:</span> <span class=\"token string\">'address'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>          title<span class=\"token operator\">:</span> <span class=\"token string\">'operation'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>          dataIndex<span class=\"token operator\">:</span> <span class=\"token string\">'operation'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>          scopedSlots<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> customRender<span class=\"token operator\">:</span> <span class=\"token string\">'operation'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  methods<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    <span class=\"token function-variable function\">submit</span><span class=\"token operator\">:</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>       <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:8000/wx_pay/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"103\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"http://localhost:8000/static/upload/\"</span><span class=\"token operator\">+</span>result<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>img</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token function\">onDelete</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dataSource<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ul>\n<li>当用户点击按钮之后，请求后端支付接口，将接口生成的二维码返回给前端</li>\n</ul>\n<p><img data-src=\"7.png\" alt=\"\"></p>\n<ul>\n<li>微信进行扫码支付，需要注意的是，该二维码有效期只有五分钟</li>\n</ul>\n<p><img data-src=\"8.png\" alt=\"\"></p>\n<ul>\n<li>支付成功之后，我们还需要对交易进行确认，所以根据微信官方文档，调用统一查询接口</li>\n</ul>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYXkud2VpeGluLnFxLmNvbS93aWtpL2RvYy9hcGkvbmF0aXZlLnBocD9jaGFwdGVyPTlfMg==\">https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=9_2</span></p>\n</blockquote>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">wx_check</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">#统一订单查询接口</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://api.mch.weixin.qq.com/pay/orderquery\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    out_trade_no <span class=\"token operator\">=</span> <span class=\"token string\">\"order_537236\"</span> <span class=\"token comment\">#支付后的商户订单号</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    key <span class=\"token operator\">=</span> <span class=\"token string\">'945b******d7'</span>  <span class=\"token comment\"># 商户 api 密钥</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    params <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token string\">'appid'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'wx0*****ff'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># APPID</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token string\">'mch_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'16*****08'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 商户号</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">'out_trade_no'</span><span class=\"token punctuation\">:</span> out_trade_no<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 订单编号</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token string\">'nonce_str'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'ibuaiVcKdpRxkhJA'</span>  <span class=\"token comment\"># 随机字符串</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    sign <span class=\"token operator\">=</span> get_sign<span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 获取签名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    params<span class=\"token punctuation\">.</span>setdefault<span class=\"token punctuation\">(</span><span class=\"token string\">'sign'</span><span class=\"token punctuation\">,</span> sign<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 添加签名到参数字典</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    xml <span class=\"token operator\">=</span> trans_dict_to_xml<span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 转换字典为 XML</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>xml<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 以 POST 方式向微信公众平台服务器发起请求</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    data_dict <span class=\"token operator\">=</span> trans_xml_to_dict<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 将请求返回的数据转为字典</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>data_dict<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> HttpResponse<span class=\"token punctuation\">(</span><span class=\"token string\">'ok'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><div class=\"note info\">\n<p>查询的订单编号可以使商户自己的订单编号，也可以是微信订单号，二者必取其一</p>\n</div>\n<p><img data-src=\"9.png\" alt=\"\"></p>\n<ul>\n<li>\n<p>访问接口 <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDAwL3d4X2NoZWNrLw==\">http://localhost:8000/wx_check/</span></p>\n<p>返回结果：</p>\n</li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>返回结果：<span class=\"token punctuation\">&#123;</span><span class=\"token string\">'return_code'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'SUCCESS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'return_msg'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'OK'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'appid'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'wx092344a76b9979ff'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mch_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1602932608'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nonce_str'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'BVoaDmxxADkpSFEl'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sign'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'23A86EB406B743E0C2C61C7E78DC9373'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'result_code'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'SUCCESS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'openid'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'oy9q36f9Dpeokj9FWyN3j0znpIqE'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'is_subscribe'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'N'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade_type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'NATIVE'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'bank_type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'OTHERS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'total_fee'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fee_type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'CNY'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'transaction_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'4200000806202012174121934231'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'out_trade_no'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'order_537236'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'attach'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'time_end'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'20201217231553'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade_state'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'SUCCESS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cash_fee'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'trade_state_desc'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'支付成功'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cash_fee_type'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'CNY'</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "Wechat"
            ]
        }
    ]
}